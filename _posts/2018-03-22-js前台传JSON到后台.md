---
layout: post
title: js前台传JSON到后台
subtitle: 
date: 2018-03-22
categories: js
tags: [js]
description: js前台传JSON到后台。
---

#### js前台传JSON到后台
- 有时候需要前台js将获取的数据组装成json格式，传到后台进行解析处理。

> JS

- json格式定义  {id:id,sort:index}
- js数组转json方法 JSON.stringify(jsonArray) 

```Javascript
function sortPicture () {
    var jsonArray = [];
    $("#pictureOption tr").each(function (index,elem) {
        var id =  $(elem).find("[name='id']").val();
        jsonArray.push({id:id,sort:index});//{id:id,sort:index} Json数据
    });
    $.ajax({
        type : "post",
        url : Feng.ctxPath+"/homePicture/sort",
        data : {
            jsonStr:JSON.stringify(jsonArray)
        },
        async : false,
        success : function(data) {
            console.log('video sort success');
        },
        error : function() {
            Feng.error("网络异常！");
        }
    });
}
```

> java

- 使用com.alibaba.fastjson.JSON 
- 将json字符串转为JSONArray 
- 遍历数组获取JSONObject，jsonArray.getJSONObject(i);
- 在用遍历数组获取JSONObject的get方法获取值

```Java
控制器：

@RequestMapping("/sort")
@ResponseBody
public Object sort(String jsonStr) {
    homeVideoService.sort(jsonStr);
    return SUCCESS_TIP;
}

//=======================================万恶的分割线================================================================
Servicec层：

@Override
public void sort(String jsonStr) {
    JSONArray jsonArray = JSON.parseArray(jsonStr);
    if(jsonArray!=null&&jsonArray.size()>0){
        for (int i = 0; i < jsonArray.size(); i++) {
            JSONObject json = jsonArray.getJSONObject(i);
            Integer id = json.get("id") == null ? null: Integer.parseInt(json.get("id").toString());
            Integer sort = json.get("sort") == null ? null: Integer.parseInt(json.get("sort").toString());
            if(id!=null){
                HomeVideo homeVideo = homeVideoMapper.selectById(id);
                homeVideo.setSort(sort);
                this.updateById(homeVideo);
            }
        }
    }
}

```
> 添加 com.alibaba.fastjson.JSON

```Java
<dependency>
	<groupId>com.alibaba</groupId>
	<artifactId>fastjson</artifactId>
	<version>1.2.31</version>
</dependency>
```


*标记：思维真的是限制我们的一堵墙吗？世界到底有多大？——在墙的另一边。
——高铭 《天才在左，疯子在右》*